<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>MoodFlix - Find Movies by Mood</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
    <style>
        :root {
            --content-max-width: 1400px;
            --content-padding: 20px;
            --text: #fff;
            --text-secondary: #aaa;
            --text-tertiary: #ccc;
            --card-bg: rgba(20, 20, 20, 0.7);
            --border-radius-md: 8px;
            --transition-normal: 0.3s ease;
            --shadow-medium: 0 10px 20px rgba(0, 0, 0, 0.3);
            --shadow-light: 0 5px 10px rgba(0, 0, 0, 0.2);
            --shadow-strong: 0 15px 30px rgba(0, 0, 0, 0.4);
            --primary: #e50914;
            --primary-hover: #f40612;
            --card-hover-bg: rgba(20, 20, 20, 0.9);
        }
        
        .content-container {
            width: 100%;
            max-width: var(--content-max-width);
            padding: var(--content-padding);
            margin: 0 auto;
        }
        
        .intro-text {
            font-size: 1.2rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            text-align: center;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }
        
        /* Mood selection styles */
        .mood-section {
            text-align: center;
            margin-bottom: 40px;
            transition: all 0.5s ease;
        }
        
        .mood-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            max-width: 900px;
            margin: 0 auto;
        }
        
        @media (max-width: 1200px) {
            .mood-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 992px) {
            .mood-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        @media (max-width: 768px) {
            .mood-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        @media (max-width: 480px) {
            .mood-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .mood {
            background-color: var(--card-bg);
            border-radius: var(--border-radius-md);
            padding: 40px 20px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            cursor: pointer;
            transition: all var(--transition-normal);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-light);
            border: 2px solid transparent;
            transform-origin: center;
        }
        
        .mood::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            opacity: 0.3;
            z-index: 0;
            transition: opacity var(--transition-normal);
        }
        
        .mood span {
            position: relative;
            z-index: 1;
        }
        
        .mood:hover {
            transform: translateY(-10px) scale(1.05);
            box-shadow: var(--shadow-medium);
            border-color: var(--primary);
        }
        
        .mood:hover::before {
            opacity: 0.5;
        }
        
        .mood.active {
            background-color: var(--primary);
            transform: translateY(-10px) scale(1.05);
            box-shadow: var(--shadow-medium);
        }
        
        .happy::before { background-image: url('https://images.unsplash.com/photo-1531686264889-56fdcabd163f?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80'); }
        .sad::before { background-image: url('https://images.unsplash.com/photo-1516585427167-9f4af9627e6c?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80'); }
        .romantic::before { background-image: url('https://images.unsplash.com/photo-1518199266791-5375a83190b7?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80'); }
        .tense::before { background-image: url('https://images.unsplash.com/photo-1509248961158-e54f6934749c?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80'); }
        .excited::before { background-image: url('https://images.unsplash.com/photo-1513151233558-d860c5398176?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80'); }
        .relaxed::before { background-image: url('https://images.unsplash.com/photo-1506126613408-eca07ce68773?ixlib=rb-1.2.1&auto=format&fit=crop&w=300&q=80'); }
        
        /* Recommendations section */
        .recommendations-section {
            margin-top: 3rem;
            position: relative;
            display: none;
            width: 100%;
        }
        
        .recommendations-section.show {
            display: block;
        }
        
        .recommendations-title {
            color: var(--text);
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .mood-name {
            color: var(--primary);
            text-transform: capitalize;
        }
        
        /* Movie grid styles */
        .movie-grid-container {
            width: 100%;
            display: flex;
            justify-content: center;
            padding: 0 24px;
            margin-left: 85px;
            margin-top: -20px;
        }

        .movie-grid {
            display: grid;
            grid-template-columns: repeat(5, 260px);
            gap: 24px;
            margin: 1rem 0;
            width: fit-content;
            max-width: 100%;
        }

        .movie-card {
            position: relative;
            border-radius: var(--border-radius-md);
            overflow: hidden;
            transition: all var(--transition-normal);
            height: 440px;
            cursor: pointer;
            box-shadow: var(--shadow-light);
            background-color: var(--card-bg);
            width: 100%;
        }
        
        .movie-card:hover {
            transform: scale(1.05);
            box-shadow: var(--shadow-strong);
            z-index: 2;
        }
        
        .movie-poster {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform var(--transition-normal);
        }
        
        .movie-card:hover .movie-poster {
            transform: scale(1.05);
        }
        
        .movie-info-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 1.5rem 1rem 1rem;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.9) 0%, rgba(0, 0, 0, 0.6) 60%, transparent 100%);
            transform: translateY(0);
            transition: transform var(--transition-normal);
        }
        
        .movie-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
            margin: 0 0 0.5rem 0;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .movie-genre {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0 0 0.5rem 0;
        }
        
        .movie-rating {
            display: flex;
            align-items: center;
            gap: 0.3rem;
            font-size: 0.9rem;
            color: var(--text-tertiary);
        }
        
        .movie-rating::before {
            content: "â˜…";
            color: #ffc107;
        }

        @media (max-width: 1400px) {
            .movie-grid-container {
                margin-left: 30px;
            }
            .movie-grid {
                grid-template-columns: repeat(4, 260px);
            }
        }
        
        @media (max-width: 1100px) {
            .movie-grid-container {
                margin-left: 20px;
            }
            .movie-grid {
                grid-template-columns: repeat(3, 260px);
            }
        }
        
        @media (max-width: 850px) {
            .movie-grid-container {
                margin-left: 10px;
            }
            .movie-grid {
                grid-template-columns: repeat(2, 260px);
            }
            .movie-card {
                height: 380px;
            }
        }
        
        @media (max-width: 580px) {
            .movie-grid-container {
                padding: 0 16px;
                margin-left: 0;
            }
            .movie-grid {
                grid-template-columns: repeat(1, 260px);
            }
            .movie-card {
                height: 440px;
            }
        }
        
        /* Loading and no results states */
        .loading, .no-results {
            text-align: center;
            padding: 3rem;
            font-size: 1.2rem;
            color: var(--text-secondary);
        }
        
        .loading::after {
            content: "...";
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: "."; }
            40% { content: ".."; }
            60%, 100% { content: "..."; }
        }
        
        /* Navbar styling */
        nav {
            display: flex;
            justify-content: center;
            flex: 1;
            margin-left: 215px; /* Add this line to move nav links to the right */
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: rgba(0, 0, 0, 0.8);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .search-profile {
            display: flex;
            align-items: center;
        }

        /* User dropdown styles */
        .user-dropdown {
            position: relative;
            cursor: pointer;
            display: flex;
            align-items: center;
        }

        .label, .username {
            font-size: 14px; /* Make both the same size */
            color: var(--text);
        }

        .label {
            color: var(--text-secondary);
            margin-right: -4px;
        }

        .username {
            font-weight: 600;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background-color: rgba(30, 30, 30, 0.95);
            border-radius: var(--border-radius-sm);
            box-shadow: var(--shadow-medium);
            min-width: 150px;
            z-index: 100;
            margin-top: 10px;
            overflow: hidden;
        }

        .dropdown-menu a {
            display: block;
            padding: 10px 15px;
            color: var(--text);
            text-decoration: none;
            transition: all var(--transition-fast);
        }

        .dropdown-menu a:hover {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--primary);
        }

        /* Search container styles */
        .search-container {
            margin-right: 20px;
        }

        .search-container form {
            display: flex;
            align-items: center;
        }

        .search-container input {
            background-color: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 14px;
            width: 200px;
            transition: all 0.3s ease;
        }

        .search-container input:focus {
            outline: none;
            border-color: var(--primary);
            width: 240px;
        }

        .search-container input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        /* Change mood button */
        .change-mood-btn {
            background-color: rgba(20, 20, 20, 0.7);
            color: var(--text);
            border: 1px solid rgba(229, 9, 20, 0.5);
            border-radius: 4px;
            padding: 10px 20px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
        }

        .change-mood-btn:hover {
            background-color: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .change-mood-btn svg {
            width: 16px;
            height: 16px;
        }
        
        /* Current mood indicator - Netflix style */
        .mood-display-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin: 0 auto 40px;
            max-width: 800px;
        }
        
        .netflix-mood-display {
            background: linear-gradient(to right, rgba(0, 0, 0, 0.7), rgba(20, 20, 20, 0.9), rgba(0, 0, 0, 0.7));
            border-radius: 8px;
            padding: 15px 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            text-align: center;
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 600px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .netflix-mood-display::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, transparent, var(--primary), transparent);
        }
        
        .netflix-mood-title {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .netflix-mood-content {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }
        
        /* Animation for mood selection */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s forwards;
        }
        
        .fade-out {
            animation: fadeOut 0.5s forwards;
        }
        
        /* Mood selection animation */
        .mood {
            transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .mood:hover {
            transform: translateY(-10px) scale(1.05);
        }
        
        .mood.selected {
            animation: selectMood 0.6s forwards;
        }
        
        @keyframes selectMood {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1.05); }
        }

        /* Get recommendations button */
        .get-recommendations-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 30px auto;
            display: none;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-medium);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .get-recommendations-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-strong);
            background: linear-gradient(135deg, var(--primary-hover), #ff0000);
        }

        .get-recommendations-btn.show {
            display: inline-flex;
        }

        .get-recommendations-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Selected moods indicator */
        .selected-moods-container {
            margin: 20px 0;
            text-align: center;
        }

        .selected-moods-label {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 10px;
        }

        .selected-moods-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .selected-mood-tag {
            background-color: rgba(20, 20, 20, 0.8);
            border: 1px solid var(--primary);
            border-radius: 20px;
            padding: 6px 12px;
            color: var(--text);
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: all 0.2s ease;
        }
        
        .selected-mood-tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
            background-color: rgba(30, 30, 30, 0.9);
        }

        .selected-mood-tag .mood-emoji {
            font-size: 1.1em;
        }

        /* Multiple moods in recommendations */
        .current-moods {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
        }

        /* Mood selection states */
        .mood.selected {
            background-color: var(--primary);
            border-color: var(--primary);
            transform: translateY(-5px) scale(1.02);
            box-shadow: var(--shadow-medium);
        }

        .mood.selected::before {
            opacity: 0.6;
        }
        
        /* Responsive adjustments for mood display */
        @media (max-width: 768px) {
            .mood-display-container {
                padding: 0 20px;
                margin-bottom: 70px;
            }
            
            .change-mood-btn {
                position: relative;
                top: auto;
                right: auto;
                transform: none;
                margin-top: 15px;
            }
            
            .netflix-mood-display {
                padding: 12px 20px;
            }
        }

        /* Quick Add to Watchlist Button */
        .quick-add-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--transition-fast);
            z-index: 10;
            opacity: 0;
        }

        .movie-card:hover .quick-add-btn {
            opacity: 1;
        }

        .quick-add-btn:hover {
            background-color: var(--primary);
            transform: scale(1.1);
        }

        .quick-add-btn svg {
            width: 20px;
            height: 20px;
            stroke: white;
        }

        .quick-add-btn.in-watchlist {
            background-color: var(--primary);
            opacity: 1;
        }

        .quick-add-btn.in-watchlist:hover {
            background-color: #cc0000;
        }

        /* Toast notification */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }

        .toast {
            background-color: rgba(20, 20, 20, 0.9);
            color: white;
            padding: 12px 20px;
            border-radius: 4px;
            margin-top: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            border-left: 4px solid var(--primary);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-icon {
            color: var(--primary);
        }

        .toast-message {
            flex: 1;
        }

        .toast-close {
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }

        .toast-close:hover {
            opacity: 1;
        }

        /* Sort dropdown styles */
        .sort-dropdown {
            position: relative;
            margin: 1rem 0 1rem -10px;
            width: fit-content;
            z-index: 100;
            opacity: 1;
            transform: translateY(0);
            transition: all 0.3s ease;
            align-self: flex-start;
        }
        
        .sort-dropdown-btn {
            background: rgba(51, 51, 51, 0.7);
            color: var(--text);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
            backdrop-filter: blur(8px);
        }
        
        .sort-dropdown-btn:hover {
            background: rgba(51, 51, 51, 0.9);
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .sort-dropdown-content {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 30, 30, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            min-width: 200px;
            margin-top: 0.5rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            display: none;
            backdrop-filter: blur(8px);
        }
        
        .sort-dropdown-content.show {
            display: block;
            animation: fadeIn 0.2s ease;
        }
        
        .sort-option {
            padding: 0.75rem 1rem;
            color: var(--text);
            cursor: pointer;
            transition: all 0.2s ease;
            display: block;
            text-align: left;
        }
        
        .sort-option:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--primary);
        }
        
        .sort-option.active {
            background: var(--primary);
            color: white;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -10px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }
        
        /* Responsive adjustments for sort dropdown */
        @media (max-width: 768px) {
            .sort-dropdown-btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.95rem;
            }
            
            .sort-dropdown-content {
                min-width: 180px;
            }
            
            .sort-option {
                padding: 0.6rem 0.8rem;
            }
        }

        /* Load more button styles */
        .load-more-btn {
            background: linear-gradient(135deg, var(--primary), var(--primary-hover));
            color: white;
            border: none;
            border-radius: 8px;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 40px auto;
            display: none;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-medium);
        }

        .load-more-btn:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-strong);
            background: linear-gradient(135deg, var(--primary-hover), #ff0000);
        }

        .load-more-btn.show {
            display: flex;
        }

        .load-more-btn svg {
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: none;
        }

        .load-more-btn.loading svg {
            display: block;
        }

        .load-more-btn.loading span {
            display: none;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">MoodFlix</div>
        <nav>
            <a href="{{ url_for('home') }}">Home</a>
            <a href="{{ url_for('watchlist') }}">My Watchlist</a>
            <a href="{{ url_for('moods') }}" class="active">Mood</a>
            <a href="{{ url_for('explore') }}">Explore</a>
        </nav>
        <div class="search-profile">
            <div class="search-container">
                <form action="{{ url_for('search') }}" method="GET">
                    <input type="text" name="query" placeholder="Search movies..." required>
                </form>
            </div>
            {% if username != "Guest" %}
            <div class="user-dropdown">
                <span class="label">Logged in as</span>
                <span class="username">{{ username }}</span>
                <div class="dropdown-menu" id="userDropdown">
                    <a href="{{ url_for('profile') }}">View Profile</a>
                    <a href="{{ url_for('logout') }}">Logout</a>
                </div>
            </div>
            {% else %}
            <span class="label">Logged in as</span>
            <a href="{{ url_for('signin') }}" class="guest">Guest</a>
            {% endif %}
        </div>
    </header>

    <main>
        <div class="content-container">
            <section class="mood-section" id="mood-selection">
                <h1 style="text-align: center; margin-top: 2rem;">How are you feeling today?</h1>
                <p class="intro-text">Select a mood and we'll recommend movies that match your vibe using our intelligent machine learning recommendation system.</p>
                
                <div class="mood-grid">
                    <div class="mood happy" data-mood="happy">
                        <span>Happy</span>
                    </div>
                    <div class="mood sad" data-mood="sad">
                        <span>Sad</span>
                    </div>
                    <div class="mood romantic" data-mood="romantic">
                        <span>Romantic</span>
                    </div>
                    <div class="mood tense" data-mood="tense">
                        <span>Tense</span>
                    </div>
                    <div class="mood excited" data-mood="excited">
                        <span>Excited</span>
                    </div>
                    <div class="mood relaxed" data-mood="relaxed">
                        <span>Relaxed</span>
                    </div>
                </div>

                <div class="selected-moods-container" id="selected-moods-container" style="display: none;">
                    <div class="selected-moods-label">Selected moods:</div>
                    <div class="selected-moods-list" id="selected-moods-list"></div>
                </div>

                <button class="get-recommendations-btn" id="get-recommendations-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7,10 12,15 17,10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                    Get Recommendations
                </button>
            </section>
            
            <section class="recommendations-section" id="recommendations-section" style="display: none;">
                <div class="mood-display-container">
                    <div class="netflix-mood-display" id="netflix-mood-display">
                        <div class="netflix-mood-title">CURRENTLY WATCHING BY MOOD</div>
                        <div class="netflix-mood-content" id="netflix-mood-content"></div>
                    </div>
                    
                    <button class="change-mood-btn" id="change-mood-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M3 12h18M3 12l4-4M3 12l4 4"></path>
                        </svg>
                        Change Mood
                    </button>
                </div>

                <div class="sort-dropdown">
                    <button class="sort-dropdown-btn" id="sort-dropdown-btn">
                        <span id="current-sort">Title (A-Z)</span>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
                    </button>
                    <div class="sort-dropdown-content" id="sort-dropdown-content">
                        <a class="sort-option active" data-sort="title" data-order="asc">Title (A-Z)</a>
                        <a class="sort-option" data-sort="title" data-order="desc">Title (Z-A)</a>
                        <a class="sort-option" data-sort="rating" data-order="desc">Rating (High to Low)</a>
                        <a class="sort-option" data-sort="rating" data-order="asc">Rating (Low to High)</a>
                        <a class="sort-option" data-sort="year" data-order="desc">Date (Newest First)</a>
                        <a class="sort-option" data-sort="year" data-order="asc">Date (Oldest First)</a>
                    </div>
                </div>
                
                <div class="movie-grid-container">
                    <div class="movie-grid" id="movie-grid"></div>
                </div>
                <button class="load-more-btn" id="load-more-btn">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"></circle>
                        <path d="M12 6v6l4 2"></path>
                    </svg>
                    <span>Load More Movies</span>
                </button>
            </section>
            
            <div id="loading" class="loading" style="display: none;">
                Finding movies for you
            </div>
            
            <div id="no-results" class="no-results" style="display: none;">
                We couldn't find any movies matching your mood. Try another one!
            </div>
        </div>
    </main>
    
    <!-- Toast container for notifications -->
    <div class="toast-container" id="toast-container"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const moodButtons = document.querySelectorAll('.mood');
            const moodSelectionSection = document.getElementById('mood-selection');
            const recommendationsSection = document.getElementById('recommendations-section');
            const movieGrid = document.getElementById('movie-grid');
            const selectedMoodSpan = document.getElementById('selected-mood');
            const loadingElement = document.getElementById('loading');
            const noResultsElement = document.getElementById('no-results');
            const changeMoodBtn = document.getElementById('change-mood-btn');
            const getRecommendationsBtn = document.getElementById('get-recommendations-btn');
            const selectedMoodsContainer = document.getElementById('selected-moods-container');
            const selectedMoodsList = document.getElementById('selected-moods-list');
            const netflixMoodContent = document.getElementById('netflix-mood-content');
            const toastContainer = document.getElementById('toast-container');
            const loadMoreBtn = document.getElementById('load-more-btn');
            
            let selectedMoods = [];
            let userWatchlist = new Set(); // Store movie titles in user's watchlist
            let currentPage = 1;
            let isLoading = false;
            let displayedMovies = new Set(); // Add this line to track displayed movies
            
            // Initialize current sort state
            let currentSort = {
                by: 'title',
                order: 'asc'
            };
            
            // Mood emojis mapping
            const moodEmojis = {
                'happy': 'ðŸ˜Š',
                'sad': 'ðŸ˜¢',
                'romantic': 'ðŸ’•',
                'tense': 'ðŸ˜°',
                'excited': 'ðŸ¤©',
                'relaxed': 'ðŸ˜Œ'
            };
            
            // Add click event to each mood button
            moodButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const mood = this.getAttribute('data-mood');
                    
                    if (this.classList.contains('selected')) {
                        // Deselect mood
                        this.classList.remove('selected');
                        selectedMoods = selectedMoods.filter(m => m !== mood);
                    } else {
                        // Select mood
                        this.classList.add('selected');
                        selectedMoods.push(mood);
                    }
                    
                    updateSelectedMoodsDisplay();
                    updateRecommendationButton();
                });
            });
            
            // Update selected moods display
            function updateSelectedMoodsDisplay() {
                if (selectedMoods.length === 0) {
                    selectedMoodsContainer.style.display = 'none';
                    return;
                }
                
                selectedMoodsContainer.style.display = 'block';
                selectedMoodsList.innerHTML = '';
                
                selectedMoods.forEach(mood => {
                    const tag = document.createElement('div');
                    tag.className = 'selected-mood-tag';
                    tag.innerHTML = `
                        <span class="mood-emoji">${moodEmojis[mood]}</span>
                        <span>${mood.charAt(0).toUpperCase() + mood.slice(1)}</span>
                    `;
                    selectedMoodsList.appendChild(tag);
                });
            }
            
            // Update recommendation button visibility
            function updateRecommendationButton() {
                if (selectedMoods.length > 0) {
                    getRecommendationsBtn.classList.add('show');
                } else {
                    getRecommendationsBtn.classList.remove('show');
                }
            }
            
            // Get recommendations button click
            getRecommendationsBtn.addEventListener('click', function() {
                if (selectedMoods.length === 0) return;
                
                // Show loading
                loadingElement.style.display = 'block';
                moodSelectionSection.style.display = 'none';
                recommendationsSection.style.display = 'none';
                noResultsElement.style.display = 'none';
                movieGrid.innerHTML = '';
                displayedMovies.clear();
                currentPage = 1;
                
                // Fetch movie recommendations
                fetchMoviesByMoods(selectedMoods);
            });
            
            // Change mood button
            changeMoodBtn.addEventListener('click', function() {
                // Hide recommendations with animation
                recommendationsSection.classList.remove('show');
                recommendationsSection.style.display = 'none';
                
                // Show mood selection
                moodSelectionSection.style.display = 'block';
                moodSelectionSection.classList.add('fade-in');
                
                setTimeout(() => {
                    moodSelectionSection.classList.remove('fade-in');
                }, 500);
            });
            
            // Function to fetch movies by multiple moods
            function fetchMoviesByMoods(moods) {
                const moodsParam = moods.join(',');
                isLoading = true;
                loadMoreBtn.classList.add('loading');
                
                // Construct URL with pagination and sorting
                const url = `/api/movies/by_multiple_moods?moods=${encodeURIComponent(moodsParam)}&page=${currentPage}&sort_by=${currentSort.by}&order=${currentSort.order}`;
                
                // First, fetch user's watchlist
                fetchUserWatchlist().then(() => {
                    fetch(url)
                        .then(response => response.json())
                        .then(data => {
                            loadingElement.style.display = 'none';
                            isLoading = false;
                            loadMoreBtn.classList.remove('loading');
                            
                            if (!data.movies || data.movies.length === 0) {
                                noResultsElement.style.display = 'block';
                                loadMoreBtn.style.display = 'none';
                                return;
                            }
                            
                            // Show recommendations section
                            recommendationsSection.style.display = 'block';
                            recommendationsSection.classList.add('show');
                            
                            // Update Netflix-style mood display
                            updateNetflixMoodDisplay();
                            
                            // Add movie cards
                            data.movies.forEach(movie => {
                                if (!displayedMovies.has(movie.title)) {
                                    displayedMovies.add(movie.title);
                                    const cardContainer = document.createElement('div');
                                    cardContainer.className = 'movie-card-container';
                                    
                                    const cardLink = document.createElement('a');
                                    cardLink.href = `/movie/${encodeURIComponent(movie.title)}`;
                                    cardLink.className = 'movie-card-link';
                                    
                                    // Check if movie is in watchlist
                                    const inWatchlist = userWatchlist.has(movie.title);
                                    
                                    cardLink.innerHTML = createMovieCard(movie);
                                    
                                    cardContainer.appendChild(cardLink);
                                    movieGrid.appendChild(cardContainer);
                                }
                            });
                            
                            // Setup quick add buttons
                            setupQuickAddButtons();
                            
                            // Update load more button visibility
                            if (data.has_more) {
                                loadMoreBtn.style.display = 'flex';
                                loadMoreBtn.classList.remove('loading');
                            } else {
                                loadMoreBtn.style.display = 'none';
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching movies:', error);
                            loadingElement.style.display = 'none';
                            noResultsElement.style.display = 'block';
                            loadMoreBtn.style.display = 'none';
                            isLoading = false;
                            loadMoreBtn.classList.remove('loading');
                        });
                });
            }
            
            // Fetch user's watchlist
            function fetchUserWatchlist() {
                // Only fetch if user is logged in
                if (document.querySelector('.username')) {
                    return fetch('/api/watchlist/get')
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Failed to fetch watchlist');
                            }
                            return response.json();
                        })
                        .then(data => {
                            userWatchlist.clear();
                            if (data.watchlist) {
                                // Extract movie titles from watchlist
                                data.watchlist.forEach(folder => {
                                    folder.movies.forEach(movie => {
                                        userWatchlist.add(movie.title);
                                    });
                                });
                            }
                        })
                        .catch(error => {
                            console.error('Error fetching watchlist:', error);
                            return Promise.resolve(); // Continue even if watchlist fetch fails
                        });
                } else {
                    return Promise.resolve(); // User not logged in, resolve immediately
                }
            }
            
            // Setup quick add buttons
            function setupQuickAddButtons() {
                const quickAddButtons = document.querySelectorAll('.quick-add-btn');
                
                quickAddButtons.forEach(button => {
                    // Remove existing event listeners to prevent duplicates
                    button.removeEventListener('click', quickAddButtonHandler);
                    // Add new event listener
                    button.addEventListener('click', quickAddButtonHandler);
                });
            }

            // Handler function for quick add buttons
            function quickAddButtonHandler(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const movieTitle = this.getAttribute('data-movie');
                const isInWatchlist = this.classList.contains('in-watchlist');
                
                if (isInWatchlist) {
                    // Remove from watchlist
                    removeFromWatchlist(movieTitle, this);
                } else {
                    // Add to watchlist
                    addToWatchlist(movieTitle, this);
                }
            }
            
            // Add movie to watchlist
            function addToWatchlist(movieTitle, buttonElement) {
                // Check if user is logged in
                if (!document.querySelector('.username')) {
                    showToast('Please sign in to add movies to your watchlist', 'error');
                    return;
                }
                
                fetch('/api/watchlist/add', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        movie_title: movieTitle
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to add movie to watchlist');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        // Update button state
                        buttonElement.classList.add('in-watchlist');
                        buttonElement.setAttribute('title', 'Remove from watchlist');
                        buttonElement.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 11l3 3L22 4"></path>
                                <path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>
                            </svg>
                        `;
                        
                        // Add to local watchlist set
                        userWatchlist.add(movieTitle);
                        
                        // Show success toast
                        showToast(`"${movieTitle}" added to your watchlist`, 'success');
                    } else {
                        showToast(data.message || 'Failed to add movie to watchlist', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error adding to watchlist:', error);
                    showToast('Error adding movie to watchlist', 'error');
                });
            }
            
            // Remove movie from watchlist
            function removeFromWatchlist(movieTitle, buttonElement) {
                fetch('/api/watchlist/remove', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        movie_title: movieTitle
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to remove movie from watchlist');
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        // Update button state
                        buttonElement.classList.remove('in-watchlist');
                        buttonElement.setAttribute('title', 'Add to watchlist');
                        buttonElement.innerHTML = `
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path>
                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                <polyline points="7 3 7 8 15 8"></polyline>
                            </svg>
                        `;
                        
                        // Remove from local watchlist set
                        userWatchlist.delete(movieTitle);
                        
                        // Show success toast
                        showToast(`"${movieTitle}" removed from your watchlist`, 'success');
                    } else {
                        showToast(data.message || 'Failed to remove movie from watchlist', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error removing from watchlist:', error);
                    showToast('Error removing movie from watchlist', 'error');
                });
            }
            
            // Show toast notification
            function showToast(message, type = 'success') {
                // Remove any existing toasts
                const existingToasts = document.querySelectorAll('.toast');
                existingToasts.forEach(toast => toast.remove());
                
                // Create and show new toast
                const toastContainer = document.getElementById('toast-container');
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                toast.textContent = message;
                toastContainer.appendChild(toast);
                
                // Trigger reflow to ensure animation works
                toast.offsetHeight;
                
                // Show the toast
                toast.classList.add('show');
                
                // Remove the toast after animation
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, 3000);
            }
            
            // Update Netflix-style mood display
            function updateNetflixMoodDisplay() {
                netflixMoodContent.innerHTML = '';
                
                selectedMoods.forEach(mood => {
                    const tag = document.createElement('div');
                    tag.className = 'selected-mood-tag';
                    tag.innerHTML = `
                        <span class="mood-emoji">${moodEmojis[mood]}</span>
                        <span>${mood.charAt(0).toUpperCase() + mood.slice(1)}</span>
                    `;
                    netflixMoodContent.appendChild(tag);
                });
            }
            
            // Add event listener to user dropdown
            const userDropdown = document.querySelector('.user-dropdown');
            if (userDropdown) {
                userDropdown.addEventListener('click', function() {
                    const menu = document.getElementById('userDropdown');
                    menu.style.display = (menu.style.display === 'block') ? 'none' : 'block';
                });
            }
            
            // Close dropdown when clicking outside
            window.addEventListener('click', function(e) {
                const dropdown = document.getElementById('userDropdown');
                if (dropdown && !e.target.closest('.user-dropdown')) {
                    dropdown.style.display = 'none';
                }
            });
            
            // Add hover effects to mood buttons
            moodButtons.forEach(button => {
                button.addEventListener('mouseenter', function() {
                    if (!this.classList.contains('selected')) {
                        this.style.transform = 'translateY(-10px) scale(1.05)';
                        this.style.boxShadow = '0 15px 30px rgba(0, 0, 0, 0.4)';
                        this.style.borderColor = '#e50914';
                    }
                });
                
                button.addEventListener('mouseleave', function() {
                    if (!this.classList.contains('selected')) {
                        this.style.transform = '';
                        this.style.boxShadow = '';
                        this.style.borderColor = 'transparent';
                    }
                });
            });

            // Sort dropdown functionality
            const sortDropdownBtn = document.getElementById('sort-dropdown-btn');
            const sortDropdownContent = document.getElementById('sort-dropdown-content');
            const sortOptions = document.querySelectorAll('.sort-option');
            const currentSortText = document.getElementById('current-sort');

            // Toggle sort dropdown
            sortDropdownBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                sortDropdownContent.classList.toggle('show');
            });

            // Close dropdown when clicking outside
            window.addEventListener('click', function(e) {
                if (!e.target.closest('.sort-dropdown')) {
                    sortDropdownContent.classList.remove('show');
                }
            });

            // Handle sort option selection
            sortOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Update active state
                    sortOptions.forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Get sort parameters
                    const sortBy = this.getAttribute('data-sort');
                    const sortOrder = this.getAttribute('data-order');
                    
                    // Update current sort text
                    let sortText = '';
                    if (sortBy === 'title') {
                        sortText = sortOrder === 'asc' ? 'Title (A-Z)' : 'Title (Z-A)';
                    } else if (sortBy === 'rating') {
                        sortText = sortOrder === 'desc' ? 'Rating (High to Low)' : 'Rating (Low to High)';
                    } else if (sortBy === 'year') {
                        sortText = sortOrder === 'desc' ? 'Date (Newest First)' : 'Date (Oldest First)';
                    }
                    currentSortText.textContent = sortText;
                    
                    // Update current sort state
                    currentSort.by = sortBy;
                    currentSort.order = sortOrder;
                    
                    // Close dropdown
                    sortDropdownContent.classList.remove('show');
                    
                    // Reset page counter and clear displayed movies
                    currentPage = 1;
                    displayedMovies.clear();
                    movieGrid.innerHTML = '';
                    
                    // Show loading state
                    loadingElement.style.display = 'block';
                    recommendationsSection.style.display = 'none';
                    
                    // Reload movies with new sort
                    if (selectedMoods.length > 0) {
                        fetchMoviesByMoods(selectedMoods);
                    }
                });
            });

            // Add click event for load more button
            loadMoreBtn.addEventListener('click', function() {
                if (isLoading) return;
                
                currentPage++;
                this.classList.add('loading');
                fetchMoviesByMoods(selectedMoods);
            });

            function createMovieCard(movie) {
                const inWatchlist = userWatchlist.has(movie.title);
                return `
                    <div class="movie-card">
                        <img src="${movie.poster_url}" alt="${movie.title} poster" class="movie-poster" />
                        <div class="movie-info-overlay">
                            <div class="movie-title">${movie.title}</div>
                            <p class="movie-genre">${movie.genre}</p>
                            <div class="movie-rating">${movie.rating}</div>
                        </div>
                        <button class="quick-add-btn ${inWatchlist ? 'in-watchlist' : ''}" data-movie="${movie.title}" title="${inWatchlist ? 'Remove from watchlist' : 'Add to watchlist'}">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                ${inWatchlist ? 
                                    '<path d="M9 11l3 3L22 4"></path><path d="M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"></path>' : 
                                    '<path d="M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline>'}
                            </svg>
                        </button>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>